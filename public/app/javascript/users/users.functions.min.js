$(function(){let e,t,s,o,n,a;$(document).on("submit",'[data-form="sign:in"], [data-form="sign:in,code"]',function(){"sign:in"==$(this).data("form")?(t=dynamicHost+"/do/users/login/request_code",a="in"):(t=dynamicHost+"/do/users/login/verify_code",a="code"),s=new FormData(this),o=$(this).closest("content-card"),n=o.next(),$.ajax({url:t,data:s,method:$(this).attr("method"),dataType:"JSON",contentType:!1,processData:!1,success:function(e){e.status&&("in"==a?(o.toggleClass("visible"),n.toggleClass("visible"),n.find("input[name='uid']").val(e.uid),setTimeout(function(){n.find("input[name='code1']").focus()},100)):(console.log(e),$(document).find("close-overlay").click(),setTimeout(function(){window.location.reload()},750))),null!==e.message&&showErrorModule(e.message)},error:function(e){console.error(e)}})}).on("submit",'[data-form="sign:up"]',function(){t=dynamicHost+"/do/users/register/signup",s=new FormData(this),o=$(this).closest("content-card"),n=o.next(),$.ajax({url:t,data:s,method:$(this).attr("method"),dataType:"JSON",contentType:!1,processData:!1,success:function(e){console.log(e),e.status&&(o.toggleClass("visible"),n.toggleClass("visible"),n.find("input[name='uid']").val(e.uid),setTimeout(function(){n.find("input[name='code1']").focus()},100)),showErrorModule(e.message)},error:function(e){console.error(e)}})}).on("input","input",function(){if(this.hasAttribute("maxlength")){e=$(this),value=this.value,n=e.next(),$previousSibling=e.prev(),$lastSibling=e.parent().find("input").last();let t=this.getAttribute("maxlength");value.length>=t?(n.focus(),$lastSibling.attr("maxlength")==$lastSibling.val().length&&e.closest("form").submit()):0==value.length&&$previousSibling.focus()}return!1}).on("click","[data-action='users:sign,out']",function(){let e=dynamicHost+"/do/users/logout";$.ajax({url:e,method:"POST",dataType:"JSON",beforeSend:()=>{showErrorModule("Logging out...")},success:e=>{e.status&&(showErrorModule(e.message),setTimeout(()=>{window.location.replace("/")},1200))},error:e=>{console.error(e)}})}).on("click","[data-action='function:friends,request,actions']",function(){let e,t=$(this),s=t.data("json"),o=parseInt(s[0].uid),n=t.data().do,a={uid:o};switch(console.log("Requesting friendship: user_id:",o),n){case"request":e=dynamicHost+"/do/users/friends/request";break;case"cancel_request":e=dynamicHost+"/do/users/friends/cancel_request"}$.ajax({url:e,method:"POST",data:a,dataType:"JSON",success:function(e){if(e.status)switch(e.action){case"request":t.removeClass("request"),t.addClass("cancel_request"),t.data("do","cancel_request"),console.log("Friendrequest has been sent!");break;case"cancel_request":t.removeClass("cancel_request"),t.addClass("request"),t.data("do","request"),console.log("Friendrequest has been canceled!")}else console.log("Request could not been sent: user_id:",o),showErrorModule(e.message)},error:function(e){showErrorModule("A wild error appeared! Fight it!")}})}).on("click","[data-action='function:friends,request,send/cancel/remove']",function(){let e,t=$(this),s=t.data("json"),o=s[0].uid,n=s[0].action,a={uid:o,action:n},r=$(".u-hdr").find("[data-action='function:friends,request,send/cancel/remove']"),i=dynamicHost+"/dyn/users/friends-add.php";switch(n){case"addFriend":case"cancelFriend":case"removeFriend":$.ajax({url:i,method:"POST",data:a,dataType:"TEXT",success:function(s){t.removeClass("addFriend, removeFriend, cancelRequest");r.find(".material-icons-round"),r.find(".text");switch(parseInt(s)){case 1:e="You are already friends!";break;case 2:e="You can't be friends with that user!";break;case 3:e="Friendrequest canceled!",t.addClass("addFriend");break;case 4:e="Friendrequest sent!",t.addClass("cancelRequest");break;case 5:e="You are no longer friends! Too bad!",t.addClass("removeFriend"),closeOverlay(),togglebody();break;default:e="A wild error appeared! Fight it!"}showErrorModule(e)},error:function(e){showErrorModule("A wild error appeared! Fight it!")}});break;case"removeFriendRequest":let s="Remove friend",d="sentiment_very_dissatisfied",c="Do you really want to give up this friendship?",u=t.data("action"),l="Yes, please!";n="removeFriend";let f=JSON.stringify([{uid:o,action:n}]);i=dynamicHost+"/dyn/popups/confirmation",$.ajax({type:"POST",url:i,data:{a:s,b:d,c:c,d:u,e:l,f:f},dataType:"HTML",success:function(e){if(0===parseInt(e))showErrorModule("A wild error appeared! Fight it!");else{addOverlay(),togglebody();var t=$(document).find("response-overlay");t.empty(),t.append(e),fitPopupModule()}},error:function(e){showErrorModule("Some random error happened, try again!")}});break;default:showErrorModule("A wild error appeared! Fight it!")}}).on("click","[data-action='function:friends,request,accept/decline']",function(){let e,t=dynamicHost+"/dyn/users/friends-requests-actions.php",s=$(this),o=s.closest(".fr-inr"),n=o.closest(".friendrequests-outer"),a=o.outerHeight(),r=s.data("json"),i=r[0].frid,d=r[0].usid,c=r[0].action,u={frid:i,usid:d,action:c};$.ajax({url:t,method:"POST",data:u,dataType:"TEXT",beforeSend:function(){showErrorModule("Verifying..."),o.css({height:a+"px"})},success:function(t){switch(t){case"1":e="You are now friends!",o.addClass("hidden").css({height:"0px"}),setTimeout(function(){o.remove()},400);break;case"2":o.addClass("hidden").css({height:"0px"}),setTimeout(function(){o.remove()},400),e="Friendrequest declined!";break;case"3":e="You won't get any friendrequests from this user!";break;default:e="A wild error appeared! Fight it!"}showErrorModule(e)},complete:function(){setTimeout(function(){n.children().length<1&&(t=dynamicHost+"/dyn/content/friends-requests-empty.php",n.load(t))},400)},error:function(e){showErrorModule("A wild error appeared! Fight it!")}})}).on("click","#settings-main radio-model .single",function(){let e,t=$(this),s=t.parent(),o=t.data("value"),n=t.hasClass("isActive");s.find(".single").each(function(){$(this).removeClass("isActive")}),s.hasClass("std")&&t.addClass("isActive"),s.find('[data-react="element:radio"]').val(o),e=$(this).closest('[data-form="users:settings"]').serialize(),n||usersSaveSettings(e)})});let usersSaveSettings=function(e){let t,s=dynamicHost+"/dyn/users/settings",o=e;$.ajax({method:"POST",dataType:"text",url:s,data:o,success:function(e){console.log(e)},error:function(e){t="A wild error appeared! Fight it!",showErrorModule(t)}})};