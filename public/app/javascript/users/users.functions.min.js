$(function(){let e,s,t,o,n,a;$(document).on("submit",'[data-form="sign:in"], [data-form="sign:in,code"]',function(){"sign:in"==$(this).data("form")?(s=dynamicHost+"/do/users/login/request_code",a="in"):(s=dynamicHost+"/do/users/login/verify_code",a="code"),t=new FormData(this),o=$(this).closest("content-card"),n=o.next(),$.ajax({url:s,data:t,method:$(this).attr("method"),dataType:"JSON",contentType:!1,processData:!1,success:function(e){e.status&&("in"==a?(o.toggleClass("visible"),n.toggleClass("visible"),n.find("input[name='uid']").val(e.uid),setTimeout(function(){n.find("input[name='code1']").focus()},100)):(console.log(e),$(document).find("close-overlay").click(),setTimeout(function(){window.location.reload()},750))),null!==e.message&&showErrorModule(e.message)},error:function(e){console.error(e)}})}).on("submit",'[data-form="sign:up"]',function(){s=dynamicHost+"/do/users/register/signup",t=new FormData(this),o=$(this).closest("content-card"),n=o.next(),$.ajax({url:s,data:t,method:$(this).attr("method"),dataType:"JSON",contentType:!1,processData:!1,success:function(e){console.log(e),e.status&&(o.toggleClass("visible"),n.toggleClass("visible"),n.find("input[name='uid']").val(e.uid),setTimeout(function(){n.find("input[name='code1']").focus()},100)),showErrorModule(e.message)},error:function(e){console.error(e)}})}).on("input","input",function(){if(this.hasAttribute("maxlength")){e=$(this),value=this.value,n=e.next(),$previousSibling=e.prev(),$lastSibling=e.parent().find("input").last();let s=this.getAttribute("maxlength");value.length>=s?(n.focus(),$lastSibling.attr("maxlength")==$lastSibling.val().length&&e.closest("form").submit()):0==value.length&&$previousSibling.focus()}return!1}).on("click","[data-action='users:sign,out']",function(){let e=dynamicHost+"/do/users/logout";$.ajax({url:e,method:"POST",dataType:"JSON",beforeSend:()=>{showErrorModule("Logging out...")},success:e=>{e.status&&(showErrorModule(e.message),setTimeout(()=>{window.location.replace("/")},1200))},error:e=>{console.error(e)}})}).on("click","[data-action='function:friends,request,actions']",function(){let e,s=$(this),t=s.data("json"),o=parseInt(t[0].uid),n=s.data().do,a={uid:o};switch(console.log("Requesting friendship: user_id:",o),n){case"request":e=dynamicHost+"/do/users/friends/request";break;case"cancel_request":e=dynamicHost+"/do/users/friends/cancel_request"}$.ajax({url:e,method:"POST",data:a,dataType:"JSON",success:e=>{if(e.status)switch(e.action){case"request":s.removeClass("request"),s.addClass("cancel_request"),s.data("do","cancel_request"),console.log("Friendrequest has been sent!");break;case"cancel_request":s.removeClass("cancel_request"),s.addClass("request"),s.data("do","request"),console.log("Friendrequest has been canceled!")}else console.log("Request could not been sent: user_id:",o),showErrorModule(e.message)},error:e=>{console.error(e)}})}).on("click","[data-action='function:friends,request,answer']",function(){let e,s=$(this),t=s.closest(".friendrequests-outer"),o=s.data("json"),n=o[0].action,a=o[0].id,i=o[0].user_sent_id,r={id:a,uid:i};switch(n){case"accept_request":e=dynamicHost+"/do/users/friends/accept_request";break;case"decline_request":e=dynamicHost+"/do/users/friends/cancel_request"}console.log("Init answering friend request. Requesting user_id:",i),console.log("URL is:",e),$.ajax({url:e,data:r,method:"POST",dataType:"JSON",success:e=>{if(console.log("Ajax done"),e.status)switch(console.log("Status is true"),t.remove(),e.action){case"accept_request":console.log("Friendrequest has been accepted!");break;case"cancel_request":console.log("Friendrequest has been canceled!")}else console.log("Status is false. Something went wrong")},error:e=>{console.error(e)}})}).on("click","#settings-main radio-model .single",function(){let e,s=$(this),t=s.parent(),o=s.data("value"),n=s.hasClass("isActive");t.find(".single").each(function(){$(this).removeClass("isActive")}),t.hasClass("std")&&s.addClass("isActive"),t.find('[data-react="element:radio"]').val(o),e=$(this).closest('[data-form="users:settings"]').serialize(),n||usersSaveSettings(e)}).on("click","usermainmenu",function(){let e=$(this),t=e.find('[data-element="notify-dot"]');s=dynamicHost+"/do/users/check_notifications/main_menu",$.ajax({url:s,dataType:"JSON",method:"POST",success:e=>{e.status&&t.remove()},error:()=>{showErrorModule("Oopsie")}})})});let usersSaveSettings=function(e){let s,t=dynamicHost+"/dyn/users/settings",o=e;$.ajax({method:"POST",dataType:"text",url:t,data:o,success:function(e){console.log(e)},error:function(e){s="A wild error appeared! Fight it!",showErrorModule(s)}})};