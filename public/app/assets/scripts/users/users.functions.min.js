$(function(){let e,t,s,a,o,n;$(document).on("submit",'[data-form="sign:in"], [data-form="sign:in,code"]',function(){"sign:in"==$(this).data("form")?(t=dynamicHost+"/do/users/login/request_code",n="in"):(t=dynamicHost+"/do/users/login/verify_code",n="code"),s=new FormData(this),a=$(this).closest("content-card"),o=a.next(),$.ajax({url:t,data:s,method:$(this).attr("method"),dataType:"JSON",contentType:!1,processData:!1,success:function(e){e.status&&("in"==n?(a.toggleClass("visible"),o.toggleClass("visible"),o.find("input[name='uid']").val(e.uid),setTimeout(function(){o.find("input[name='code1']").focus()},100)):($(document).find("close-overlay").click(),setTimeout(function(){window.location.reload()},750))),null!==e.message&&showErrorModule(e.message)},error:function(e){console.error(e)}})}).on("submit",'[data-form="sign:up"]',function(){t=dynamicHost+"/do/users/register/signup",s=new FormData(this),a=$(this).closest("content-card"),o=a.next(),$.ajax({url:t,data:s,method:$(this).attr("method"),dataType:"JSON",contentType:!1,processData:!1,success:function(e){e.status&&(a.toggleClass("visible"),o.toggleClass("visible"),o.find("input[name='uid']").val(e.uid),setTimeout(function(){o.find("input[name='code1']").focus()},100)),showErrorModule(e.message)},error:function(e){console.error(e)}})}).on("input","input",function(){if(this.hasAttribute("maxlength")){e=$(this),value=this.value,o=e.next(),$previousSibling=e.prev(),$lastSibling=e.parent().find("input").last();let t=this.getAttribute("maxlength");value.length>=t?(o.focus(),$lastSibling.attr("maxlength")==$lastSibling.val().length&&e.closest("form").submit()):0==value.length&&$previousSibling.focus()}return!1}).on("click","[data-action='users:sign,out']",function(){let e=dynamicHost+"/do/users/logout";$.ajax({url:e,method:"POST",dataType:"JSON",beforeSend:()=>{showErrorModule("Logging out...")},success:e=>{e.status&&(showErrorModule(e.message),setTimeout(()=>{window.location.replace("/")},1200))},error:e=>{console.error(e)}})}).on("click","[data-action='function:friends,request,actions']",function(){let e,t=$(this),s=t.data("json"),a=parseInt(s[0].uid),o=t.data().do,n={uid:a};switch(o){case"request":e=dynamicHost+"/do/users/friends/request";break;case"cancel_request":e=dynamicHost+"/do/users/friends/cancel_request"}$.ajax({url:e,method:"POST",data:n,dataType:"JSON",success:e=>{if(e.status)switch(e.action){case"request":t.removeClass("request"),t.addClass("cancel_request"),t.data("do","cancel_request");break;case"cancel_request":t.removeClass("cancel_request"),t.addClass("request"),t.data("do","request")}else showErrorModule(e.message)},error:e=>{console.error(e)}})}).on("click","[data-action='function:friends,request,answer']",function(){let e,t=$(this),s=t.closest(".friendrequests-outer"),a=t.data("json"),o=a[0].action,n=a[0].id,i=a[0].user_sent_id,r={id:n,uid:i};switch(o){case"accept_request":e=dynamicHost+"/do/users/friends/accept_request";break;case"decline_request":e=dynamicHost+"/do/users/friends/cancel_request"}$.ajax({url:e,data:r,method:"POST",dataType:"JSON",success:e=>{if(e.status)return s.remove(),void e.action},error:e=>{console.error(e)}})}).on("click","#settings-main radio-model .single",function(){let e,t=$(this),s=t.parent(),a=t.data("value"),o=t.hasClass("isActive");s.find(".single").each(function(){$(this).removeClass("isActive")}),s.hasClass("std")&&t.addClass("isActive"),s.find('[data-react="element:radio"]').val(a),e=$(this).closest('[data-form="users:settings"]').serialize(),o||usersSaveSettings(e)}).on("click","usermainmenu",function(){let e=$(this),s=e.find('[data-element="notify-dot"]');t=dynamicHost+"/do/users/check_notifications/main_menu",$.ajax({url:t,dataType:"JSON",method:"POST",success:e=>{e.status&&s.remove()},error:()=>{showErrorModule("Oopsie")}})})});let usersSaveSettings=function(e){let t,s=dynamicHost+"/dyn/users/settings",a=e;$.ajax({method:"POST",dataType:"text",url:s,data:a,success:function(e){},error:function(e){t="A wild error appeared! Fight it!",showErrorModule(t)}})};